<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Architesta{% endblock %}</title>
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css">
            <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/dataTables.bootstrap4.min.css">
            <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
            <link href="https://cdn.datatables.net/buttons/1.7.0/css/buttons.dataTables.min.css" rel="stylesheet">
            



            <style type="text/css" class="init">
            
            </style>
            <script type="text/javascript" language="javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
            <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
            <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.10.23/js/dataTables.bootstrap4.min.js"></script>
            <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/buttons/1.7.0/js/dataTables.buttons.min.js"></script>
            <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/buttons/1.7.0/js/buttons.print.min.js"></script>
            <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/buttons/1.7.0/js/buttons.html5.min.js"></script>
            <script type="text/javascript" language="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
            <script type="text/javascript" language="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
            <script type="text/javascript" language="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>

 
            <link rel="stylesheet" href={{ asset('css/general.css') }}>

            <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
            <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>


        {# Run `composer require symfony/webpack-encore-bundle`
           and uncomment the following Encore helpers to start using Symfony UX #}
        {% block stylesheets %}
            {#{{ encore_entry_link_tags('app') }}#}
        {% endblock %}
        {% block javascripts %}
            {#{{ encore_entry_script_tags('app') }}#}
        {% endblock %}


       <script type="text/javascript" class="init">
       {% set ruta_ajax = id_tabla ~ '_ajax' %}
            $(document).ready(function() {
                tabla= $('#{{id_tabla}}').DataTable({
                "pagging": true,
                "pageLength": 25,
                ajax: {
                    url: '{{ path(ruta_ajax) }}',
                    type: 'GET'
                },
                language: {
                    "decimal": "",
                    "emptyTable": "No hay información",
                    "info": "Mostrando _START_ a _END_ de _TOTAL_ Entradas",
                    "infoEmpty": "Mostrando 0 a 0 de 0 Entradas",
                    "infoFiltered": "(Filtrado de _MAX_ total entradas)",
                    "infoPostFix": "",
                    "thousands": ",",
                    "lengthMenu": "Mostrar _MENU_ Entradas",
                    "loadingRecords": "Cargando...",
                    "processing": "Procesando...",
                    "search": "Buscar:",
                    "zeroRecords": "Sin resultados encontrados",
                    "paginate": {
                        "first": "Primero",
                        "last": "Ultimo",
                        "next": ">>",
                        "previous": "<<"
                    }
                },
                dom: 'lBfrtip',

                buttons: [ 
                    {extend: 'excelHtml5', autoFilter: true, sheetName: 'Exported data',className: 'boton'},  
                    {extend: 'copyHtml5',className: 'boton'},
                    {extend: 'csvHtml5', className: 'boton'},
                    {extend: 'pdfHtml5', className: 'boton'},

                ],


                initComplete: function () {
                    this.api().columns().every( function () {
                        var column = this;
                        if ($(column.footer()).text() != "" && $(column.footer()).text() != "-"  && $(column.footer()).text().substring(0,2) != "@@" ) {
                                
                            var select = $('<select><option value="">Muestra todos</option></select>')
        //                    var select = $('<select><option value=""></option></select>')
                                .appendTo( $(column.footer()).empty() )
                                .on( 'change', function () {
                                    var val = $.fn.dataTable.util.escapeRegex(
                                        $(this).val()
                                    );
            
                                    column
                                        .search( val ? '^'+val+'$' : '', true, false )
                                        .draw();
                                } );
                            
                            column.data().unique().sort().each( function ( d, j ) {
                        //     alert( $(column.header()).text() );
                                if (d.length >50 ) {
                                    var valor = d.substring(0,50)+'...';
                                }
                                else var valor=d;
                                select.append( '<option value="'+d+'">'+valor+'</option>' )
                            } );
                        }   
                        else {
                            if ($(column.footer()).text() == "") {
                            var boton = $('<button type="button" class="btn btn-outline-dark btn-sm ">Recarga</button>')
                                    .appendTo( $(column.footer()).empty() )
                                    .on( 'click', function() {
        //                                 tabla.search('').columns().search('').draw('');
                                location.reload();
                                    }

                                    );  
                            } else
                            if ($(column.footer()).text().substring(0,2) == "@@") {
                                    var titulo = $(column.footer()).text().substring(2);
                                
                                    var entrada = $('<input type="text" placeholder="Filtrar '+titulo+'" />')
                                    .appendTo( $(column.footer()).empty() )
                                    .on( 'keyup change', function () {
                                        var val =
                                        $(this).val()
                                    column
                                        .search( val)
                                        .draw();
                                    }
                                    );
                            }
                            else {
                                $('').appendTo( $(column.footer()).empty());
                            }
                        }

                    } );
                }
                });
            } );  
        </script>


    </head>
    <body>   
            {% if muestraMenu %}
                {% include 'menuUsuario.php' %}
            {% endif %}

            {% block body %}
            {% endblock %}
            {% include 'botonera.php' %}
    </body>
          <div class="container">
                {% if app.user %}
                <p class="float-right"><small>Estás conectad@ como {{ app.user.email }}. <a href="{{ path('app_logout') }}">Logout</a></small></p>
                {% endif %}
        </div>
<br><br>

</div>
<!--
    <div class="container">
        <div class="card {{ app.session.get('estilo') }}">
            <div class="card-body">
                <img  class="card-img float-right col-md-2" src="{{ asset('img/LogoCARM02.png') }}" alt="CARM logo" >
                <blockquote class="blockquote mb-0">
                <p>OpenCarm. Datos Abiertos en la Comunidad Autónoma de la Región de Murcia.</p>
                <small class="text-muted">¿Sueñan los androides con ovejas mecánicas?</small>
                </blockquote>
            </div>
        </div>
    </div>
-->

</div>

</html>
